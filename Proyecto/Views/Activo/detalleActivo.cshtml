@model Proyecto.Entities.ActivoEnt

@{
    ViewBag.Title = "detalleActivo";
}

<style>
    li {
        padding: 2px; 
    }
</style>

@{ 
    //Calculate the level of risk to complete the information of the card on based on the number of complete validations
    int totalValidacion = 0;
    int validacionesCompletas = 0;
    string nivelRiesgo = "";
    string descripcionRiesgo = "Por favor complete la información correspondiente en las validaciones para reducir el nivel de riesgo  de acuerdo con las politicas y normas";
    string imgPath = "/templates/assets/img/semaforo_amarillo.png";

    foreach (var validacion in Model.validacionesActivo)
    {
        totalValidacion += 1;

        if (validacion.valor != null)
        {
            validacionesCompletas += 1;
        }
    }

    double porcentajeValidacion = (Convert.ToDouble(validacionesCompletas) / Convert.ToDouble(totalValidacion))*100;

    if (porcentajeValidacion < 50)
    {
        nivelRiesgo = "Alto";
        imgPath = "/templates/assets/img/semaforo_rojo.png";

    } else if (porcentajeValidacion > 50 && porcentajeValidacion < 80)
    {
        nivelRiesgo = "Medio";
        imgPath = "/templates/assets/img/semaforo_amarillo.png";
    } else
    {
        nivelRiesgo = "Bajo";
        descripcionRiesgo = "Buen trabajo, por favor recuerde confirmar que la información del activo siempre este actualizada y de acuerdo con las politicas y normas";
        imgPath = "/templates/assets/img/semaforo_verde.png";
    }

}


@{ 
    //Calculate depreciation

    double depreciacionMensual = Model.valorAdquisicion / (Model.claseActivo.vidaUtil * 12);
    double depreciacionAcumulada = depreciacionMensual * Model.periodosDepreciados; 
}


<div class="container-fluid px-4" style="padding-top: 25px">

    <div class="row">

        <div class="col-md-5">
            <div class="card mb-5">
                <div class="card-body" style="background: rgb(79,80,96); background: linear-gradient(6deg, rgba(79,80,96,1) 17%, rgba(0,0,0,1) 65%); color: white ">
                    <div class="row">
                        <div class="col-xl-3" align="center">
                            <img src=@imgPath alt="Indicador riesgo" style="width: 100%; max-width: 250px; margin-left: auto; margin-right: auto"/>
                        </div>
                        <div class="col-xl-9">
                            <h5>El nivel de riesgo del activo es:</h5>
                            <h1>@nivelRiesgo</h1>
                            <p>@descripcionRiesgo</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Detalles @Model.descripcionActivo
                </div>
                <div class="card-body">

                    <div class="row">
                        <div class="col-xl-6">
                            <ul>
                                <li>Clase Activo: @Model.claseActivo.descripcionClase</li>
                                <li>Ubicación - Edificio: @Model.ubicacionActivo.idEdificio - @Model.ubicacionActivo.descripcionSeccion</li>
                                <li>Dueño: @Model.duennoActivo.nombre</li>
                                <li>Estado: @Model.estadoActivo.descripcionEstado</li>
                            </ul>
                        </div>
                        <div class="col-xl-6">
                            <ul>
                                <li>Fecha de Adquisición: @Model.fechaAdquiscion</li>
                                <li>Valor Adquisición: @string.Format("{0:#,##0.00}", @Model.valorAdquisicion)</li>
                                <li>Periodos Depreciados: @Model.periodosDepreciados</li>
                                <li>Depreciacíon Acumulada: @string.Format("{0:#,##0.00}", @depreciacionAcumulada)</li>
                            </ul>
                        </div>
                    </div>

                    
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-check me-1"></i>
                    Detalle Validaciones @Model.descripcionActivo
                </div>
                <div class="card-body">
                    <table id="datatablesSimple">
                        <thead>
                            <tr>
                                <th>Descripción Validacion</th>
                                <th>Valor Actual</th>
                                <th>Modificación</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Descripción Validacion</th>
                                <th>Valor Actual</th>
                                <th>Modificación</th>
                            </tr>
                        </tfoot>
                        <tbody>
                            @foreach (var validacion in Model.validacionesActivo)
                            {
                                <tr>
                                    <td>@validacion.descripcionValidacion</td>
                                    <td>@validacion.valor</td>
                                    <td><button class="btn btn-outline-primary" onclick="editarValidacion(@Model.idActivo,@validacion.idValidacion)"><i class="fas fa-pen"></i></button></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>



